<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Viktor Gradoux">
<meta name="dcterms.date" content="2024-05-01">

<title>Forecasting a small open economy with a FAVAR in R : Evidence from Switzerland</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="FAVAR_replication_files/libs/clipboard/clipboard.min.js"></script>
<script src="FAVAR_replication_files/libs/quarto-html/quarto.js"></script>
<script src="FAVAR_replication_files/libs/quarto-html/popper.min.js"></script>
<script src="FAVAR_replication_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="FAVAR_replication_files/libs/quarto-html/anchor.min.js"></script>
<link href="FAVAR_replication_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="FAVAR_replication_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="FAVAR_replication_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="FAVAR_replication_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="FAVAR_replication_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="FAVAR_replication_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="FAVAR_replication_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#framework" id="toc-framework" class="nav-link active" data-scroll-target="#framework">Framework</a>
  <ul class="collapse">
  <li><a href="#disclaimer" id="toc-disclaimer" class="nav-link" data-scroll-target="#disclaimer">Disclaimer</a></li>
  </ul></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a>
  <ul class="collapse">
  <li><a href="#packages-loading" id="toc-packages-loading" class="nav-link" data-scroll-target="#packages-loading">Packages loading</a></li>
  <li><a href="#data-loading" id="toc-data-loading" class="nav-link" data-scroll-target="#data-loading">Data loading</a></li>
  <li><a href="#seasonal-adjustment" id="toc-seasonal-adjustment" class="nav-link" data-scroll-target="#seasonal-adjustment">Seasonal adjustment</a></li>
  <li><a href="#stationarity" id="toc-stationarity" class="nav-link" data-scroll-target="#stationarity">Stationarity</a></li>
  <li><a href="#normalization-for-pca" id="toc-normalization-for-pca" class="nav-link" data-scroll-target="#normalization-for-pca">Normalization for PCA</a></li>
  <li><a href="#dealing-with-missing-values" id="toc-dealing-with-missing-values" class="nav-link" data-scroll-target="#dealing-with-missing-values">Dealing with missing values</a></li>
  <li><a href="#frequency" id="toc-frequency" class="nav-link" data-scroll-target="#frequency">Frequency</a></li>
  </ul></li>
  <li><a href="#favar-estimation" id="toc-favar-estimation" class="nav-link" data-scroll-target="#favar-estimation">FAVAR estimation</a>
  <ul class="collapse">
  <li><a href="#favar-framework" id="toc-favar-framework" class="nav-link" data-scroll-target="#favar-framework">FAVAR framework</a></li>
  <li><a href="#factors-extraction" id="toc-factors-extraction" class="nav-link" data-scroll-target="#factors-extraction">Factors extraction</a></li>
  <li><a href="#var-modeling" id="toc-var-modeling" class="nav-link" data-scroll-target="#var-modeling">VAR Modeling</a></li>
  <li><a href="#diagnostic-checks" id="toc-diagnostic-checks" class="nav-link" data-scroll-target="#diagnostic-checks">Diagnostic checks</a></li>
  <li><a href="#fanchart" id="toc-fanchart" class="nav-link" data-scroll-target="#fanchart">Fanchart</a></li>
  </ul></li>
  <li><a href="#pseudo-out-of-sample-evaluation" id="toc-pseudo-out-of-sample-evaluation" class="nav-link" data-scroll-target="#pseudo-out-of-sample-evaluation">Pseudo Out-of-sample evaluation</a>
  <ul class="collapse">
  <li><a href="#mean-squared-forecast-errors" id="toc-mean-squared-forecast-errors" class="nav-link" data-scroll-target="#mean-squared-forecast-errors">Mean squared forecast errors</a>
  <ul class="collapse">
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Forecasting a small open economy with a FAVAR in R : Evidence from Switzerland</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Viktor Gradoux </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="framework" class="level1">
<h1>Framework</h1>
<p>Conducted for <strong>CREA</strong> (<em>Swiss Institute of Applied Macroeconomics</em> of University of Lausanne) and part of my master thesis, we propose a <strong>Factor Augmented VAR (FAVAR)</strong> à la <span class="citation" data-cites="Bernanke_2005">Bernanke, Boivin, and Eliasz (<a href="#ref-Bernanke_2005" role="doc-biblioref">2005</a>)</span> tailored for a <strong>small economy</strong> in the spirit of <span class="citation" data-cites="Mumtaz_2009">Mumtaz and Surico (<a href="#ref-Mumtaz_2009" role="doc-biblioref">2009</a>)</span> to forecast real Swiss GDP growth. We use principal components analysis and expectation-Maximization algorithm to extract factors from a diverse set of a large number of variables with missing values (and different frequencies) and modeled them with the target variable within a VAR framework in a two step estimation approach. Our FAVAR remains structural by dividing the model into two blocks : one for foreign and one for domestic factors. Each block encompasses a <strong>real activity, inflation, money supply &amp; interest rates and financial conditions factor</strong>, contributing to <strong>the model’s economic interpretability</strong>. To assess its out-of-sample performance, we compare our FAVAR model to different benchmarks, including univariate and multivariate models, across various forecasting horizons (up to 12 quarters ahead) and over different evaluation sample.</p>
<p>In this post, we aim to outline <strong>the key steps in building an advanced forecasting model akin to those used by institutions</strong>. We will cover everything from data collection and preparation to the out-of-sample forecasting exercises, providing code snippets to facilitate replication. Our main focus will be on implementing the cutting-edge two-step estimation FAVAR approach in R, which is particularly efficient at handling a large number of variables.</p>
<section id="disclaimer" class="level3">
<h3 class="anchored" data-anchor-id="disclaimer">Disclaimer</h3>
<p>The author of this work did his internship at the CREA (Swiss Institute of Applied Macroeconomics of University of Lausanne) under the supervision of Mathieu Grobéty and Brendan Berthold. <strong>The opinions and assessments herein presented pertain to the author and should not be related to the views of CREA. CREA is not liable in any way for the present paper.</strong> The data were retrieved through Datastream at CEDIF (Centre de Documentation et d’Initiation Financière) solely for the purpose of this project : “Forecasting the Swiss Economy,” which is currently pending. Unfortunately, for proprietary reasons, we will not display the dataset.</p>
</section>
</section>
<section id="dataset" class="level1">
<h1>Dataset</h1>
<p>Every data series was collected carefully from <em>Datastream</em> by myself and automated by request at CEDIF for future use and updating. The static data series of each country are in the different static excel files from 1980Q1 to 2023Q3. In total, there are <strong>320 variables</strong> (152 quarterly, 154 monthly, 14 daily). The dataset consists of 155 domestic variables from Switzerland and 172 foreign variables that capture foreign economic activity which is relevant for a small-open economy like Switzerland. The foreign variables encompass variables from the main trading partners in Europe, such as <em>Germany, France, Italy and the United Kingdom</em>, as well as other main trading partners such as the <em>United States, China and Japan</em>. Then, our dataset contains 4 types of variables as in <span class="citation" data-cites="Mumtaz_2009">Mumtaz and Surico (<a href="#ref-Mumtaz_2009" role="doc-biblioref">2009</a>)</span> : real activity data including real GDP, gross value added, industrial production, investment, consumption, exports, imports, employment, vacancies, consumer confidence index, retail sales; inflation data including the main price indices (GDP Deflator, CPI, core inflation, PPI, oil prices); money &amp; interest rates data including money supply M1, M2, M3, banknotes in circulation, sight deposits, saving deposits and the different interest rates (policy rates, discount rates, government bond yields, mortgage lending rates. . . ) and finally financial conditions variables including house prices, stock prices, uncertainty indexes and effective exchange rates. Swiss variables are more granular, with more precise data by industry and sector, in order to better capture accurately the domestic dynamics.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="FAVAR_replication_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="data-preparation" class="level1">
<h1>Data Preparation</h1>
<section id="packages-loading" class="level3">
<h3 class="anchored" data-anchor-id="packages-loading">Packages loading</h3>
<p>Firstly, we have to <strong>install and load the necessary libraries</strong>. We try to limit the use of packages and rely only on the important ones.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"seasonal"</span>, <span class="st">"tseries"</span>,<span class="st">"splines"</span>,<span class="st">"vars"</span>,<span class="st">"lmtest"</span>,<span class="st">"readxl"</span>, <span class="st">"missMDA"</span>, <span class="st">"lubridate"</span>,<span class="st">"zoo"</span>,<span class="st">"forecast"</span>,<span class="st">"knitr"</span>,<span class="st">"dfms"</span>,<span class="st">"xts"</span>, <span class="st">"stats"</span>,<span class="st">"kableExtra"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># `tidyverse` is the most important library in the world, very important for data manipulation, data wrangling, nice plots...</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># `lubridate` designed to make working with dates and times easier and more intuitive</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># `seasonal`for variables seasonal adjustment using X13-ARIMA SEATS procedure</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># `tseries`, `xts`, `zoo` for time series manipulation and unit root tests</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># `splines` for piecewise spline cubic interpolation</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># `vars` for Vector Auto Regressive estimation and prediction</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># `missMDA`for missing values imputation using PCA-EM algorithm</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># `readxl` for reading excel files</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># `forecast`for ARIMA forecasting and Diebold Mariano tests</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># `knitr` and `KableExtra`for creating nice tables in LaTex or HTML </span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># `stats` for principal components analysis</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#function</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>libraries <span class="ot">&lt;-</span> <span class="cf">function</span>(packages){</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(package <span class="cf">in</span> packages){</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#checks if package is installed</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(package, <span class="at">character.only =</span> <span class="cn">TRUE</span>)){</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      <span class="co">#If package does not exist, then it will install</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">install.packages</span>(package, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">#Loads package</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(package, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#apply the function passing the packages vector as an argument</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">libraries</span>(packages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each Excel file corresponds to a country (<em>Switzerland, Japan, Germany, USA, United Kingdom, France, China, Italy</em>). Within each Excel file, each sheet represents a type of variable (Real Activity, Inflation, Money &amp; Interest Rates, and Financial Conditions) with the corresponding frequency. For example <em>“RA_q”</em> refers to Real Activity variables in quarterly frequency. In this next code chunk, we <strong>load the different data sets</strong> using some loops in order to get every quarterly variables (Real Activity, Inflation, Money and Interest Rates and Financial conditions) of each country in one data frame.</p>
</section>
<section id="data-loading" class="level3">
<h3 class="anchored" data-anchor-id="data-loading">Data loading</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Switzerland'</span>, <span class="st">'Japan'</span>, <span class="st">'Germany'</span>, <span class="st">'USA'</span>, <span class="st">'UK'</span>, <span class="st">'France'</span>, <span class="st">'China'</span>, <span class="st">'Italy'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sheets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'RA_q'</span>, <span class="st">'INF_q'</span>, <span class="st">'FC_q'</span>,<span class="st">'MI_q'</span>) </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># RA_q for Real Activity variables, INF_q for inflation variables, FC_q for financial conditions variables all in quarterly frequency</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>quarterly_data <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"1980-01-01"</span>)  <span class="co"># Start date</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2023-04-01"</span>)    <span class="co"># End date</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_date, end_date, <span class="at">by =</span> <span class="st">"quarter"</span>)  <span class="co"># Generate quarterly dates</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>quarter_dates <span class="ot">&lt;-</span> zoo<span class="sc">::</span><span class="fu">as.Date.yearqtr</span>(zoo<span class="sc">::</span><span class="fu">as.yearqtr</span>(dates, <span class="at">format =</span> <span class="st">'Q%q %Y'</span>))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">yq =</span> quarter_dates)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (country <span class="cf">in</span> countries) {</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (sheet <span class="cf">in</span> sheets) {</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    file_path <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"data/"</span>, country, <span class="st">".xlsm"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the sheet exists in the Excel file</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (sheet <span class="sc">%in%</span> <span class="fu">excel_sheets</span>(file_path)) {</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>      sheet_name <span class="ot">&lt;-</span> sheet</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path, <span class="at">sheet =</span> sheet_name, <span class="at">skip =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">date =</span> Code) <span class="sc">%&gt;%</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">yq =</span> zoo<span class="sc">::</span><span class="fu">as.Date.yearqtr</span>(zoo<span class="sc">::</span><span class="fu">as.yearqtr</span>(date, <span class="at">format =</span> <span class="st">'Q%q %Y'</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(yq, <span class="fu">everything</span>(), <span class="sc">-</span>date) </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>      quarterly_aggregate <span class="ot">&lt;-</span> <span class="fu">full_join</span>(quarterly_aggregate,data, <span class="at">by=</span><span class="st">'yq'</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Sheet"</span>, sheet, <span class="st">"does not exist in"</span>, country, <span class="st">".xlsm</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sheet INF_q does not exist in Switzerland .xlsm
Sheet MI_q does not exist in Switzerland .xlsm
Sheet FC_q does not exist in Japan .xlsm
Sheet MI_q does not exist in Japan .xlsm
Sheet FC_q does not exist in Germany .xlsm
Sheet MI_q does not exist in Germany .xlsm
Sheet FC_q does not exist in USA .xlsm
Sheet MI_q does not exist in USA .xlsm
Sheet FC_q does not exist in UK .xlsm
Sheet MI_q does not exist in UK .xlsm
Sheet FC_q does not exist in France .xlsm
Sheet MI_q does not exist in France .xlsm
Sheet INF_q does not exist in China .xlsm
Sheet FC_q does not exist in China .xlsm
Sheet MI_q does not exist in China .xlsm
Sheet FC_q does not exist in Italy .xlsm
Sheet MI_q does not exist in Italy .xlsm</code></pre>
</div>
</div>
<p>Then, we <strong>load the merging excel file</strong> with the corresponding information of each variable (description of the variable, seasonal adjustment, type of variable, country…)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>merging.df <span class="ot">=</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">'data/merging_final.xlsx'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Frequency <span class="sc">==</span> <span class="st">'quarterly'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">TickerDatastream=</span>Symbol) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">'[[:punct:] ]+'</span>,<span class="st">' '</span>,TickerDatastream))) <span class="co">#R does not understand the "..." in the Ticker Datastream so we get rid of it</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate <span class="ot">=</span> quarterly_aggregate <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> variable, <span class="at">value =</span> value, <span class="sc">-</span>yq) <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">'[[:punct:] ]+'</span>,<span class="st">' '</span>,variable))) <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(merging.df, <span class="at">by =</span> <span class="st">'variable'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value=</span><span class="fu">as.numeric</span>(value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="seasonal-adjustment" class="level3">
<h3 class="anchored" data-anchor-id="seasonal-adjustment">Seasonal adjustment</h3>
<p>Then, the time series not already seasonal adjusted should be <strong>seasonal adjusted</strong> for the analysis using the X13-ARIMA SEATS procedure used by the Census Bureau and most of the central banks (European Central Bank, Bank of Spain…) . Therefore, the <code>seasonal</code> library is used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># seasonal adjust the quarterly variables that are not with final(seas(.)) command. </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate_no_SA <span class="ot">=</span> quarterly_aggregate <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Adj <span class="sc">==</span> <span class="st">'no SA'</span> <span class="sc">&amp;</span> variable <span class="sc">!=</span> <span class="st">'SWIPCONSH'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(value) <span class="sc">%&gt;%</span>  <span class="co"># drop the missing values before seasonal adjustment</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value=</span><span class="fu">final</span>(<span class="fu">seas</span>(<span class="fu">ts</span>(value, <span class="at">frequency =</span> <span class="dv">4</span>, <span class="at">start =</span><span class="fu">c</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(yq)[<span class="dv">1</span>],<span class="dv">1</span>))))) <span class="co"># argument inside final(seas(.)) only possible in ts format (frequency = 4 because of quarterly frequency)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># variables that are already seasonal adjusted</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate_SA <span class="ot">=</span> quarterly_aggregate <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Adj <span class="sc">!=</span> <span class="st">'no SA'</span>) <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(value)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Re aggregate </span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate_seas <span class="ot">=</span> <span class="fu">rbind</span>(quarterly_aggregate_no_SA, quarterly_aggregate_SA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to check if the seasonal adjustment was correctly done we plot a random seasonal adjusted variable (variable = ‘SWTA3136N’) with <code>ggplot</code> (already loaded in the <code>tidyverse</code> package)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a quarterly variable (in blue non seasonal adjusted variable and in black seasonal adjusted)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Adj <span class="sc">==</span> <span class="st">'no SA'</span> <span class="sc">&amp;</span> variable <span class="sc">!=</span> <span class="st">'SWIPCONSH'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value_raw =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(yq, variable, value_raw) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(quarterly_aggregate_seas, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'yq'</span>, <span class="st">'variable'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable <span class="sc">==</span> <span class="st">'SWTA3136N'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> yq, <span class="at">y =</span> value, <span class="at">color =</span> <span class="st">'Seasonal Adjusted'</span>)) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> yq, <span class="at">y =</span> value_raw, <span class="at">color =</span> <span class="st">'Non Seasonal Adjusted'</span>)) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable) <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Adjustment"</span>, </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">'Seasonal Adjusted'</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">'Non Seasonal Adjusted'</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span> </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="FAVAR_replication_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="stationarity" class="level3">
<h3 class="anchored" data-anchor-id="stationarity">Stationarity</h3>
<p>Then, each series is transformed to be <strong>approximately integrated of order 0 by taking the log-difference</strong>. To ensure consistency regardless of their frequencies, all variables have been transformed into quarter-on-quarter growth rates for quarterly variables and 3-month growth rates for monthly variables, i.e in growth rates, except for interest rates and yields.</p>
<p>To check the stationarity of the transformed time series, we apply an <strong>augmented Dickey Fuller test</strong> with a 10% rejection of the null hypothesis H0. Once a first difference of the level/logarithmic-series applied , a few series were not judged stationary with respect to the unit-root test. In these cases, a second difference of the level/logarithmic-series is applied. We can also apply other unit root/stationarity tests like <em>KPSS</em> or <em>Phillips-Perron</em> test.</p>
<p> is approximated using <strong>Swiss real GDP from SECO in level already adjusted for seasonal, calendar and sport event effects</strong>. Here, the target variable <span class="math inline">\(Y_t\)</span> depicts the quarter-on-quarter GDP growth rate corresponding to the change from the previous quarter. It is as defined as :</p>
<p><span class="math display">\[\begin{equation}
Y_t = 100 \times \log\left(\frac{Y_t^l}{Y_{t-1}^l}\right)
\end{equation}\]</span> with <span class="math inline">\(Y_t^l\)</span> the real GDP from SECO in level at quarter t and <span class="math inline">\(Y_{t-1}^l\)</span> at quarter <span class="math inline">\(t-1\)</span>. It is a quarterly variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply first log difference on quarterly dataset to make them stationary </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate_seas <span class="ot">=</span> quarterly_aggregate_seas <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> (<span class="fu">log</span>(value) <span class="sc">-</span> <span class="fu">log</span>(<span class="fu">lag</span>(value)))<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Adf test with tseries library</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate_seas_adf_test <span class="ot">=</span> quarterly_aggregate_seas <span class="sc">%&gt;%</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>(value) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">adf_test_p_value =</span> <span class="fu">adf.test</span>(value)<span class="sc">$</span>p.value) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(quarterly_aggregate_seas_adf_test<span class="sc">$</span>adf_test_p_value)) <span class="co"># p-values overview</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.01000000 0.01442791 0.01859046 0.01962556 0.02173802 0.01584546
 [7] 0.01731356 0.01893731 0.03898203 0.05269736 0.01269812 0.02826987
[13] 0.01631024 0.01058451 0.07758065 0.13447386 0.01892127 0.03274027
[19] 0.02248844 0.01349715 0.01115918 0.09133751 0.01261217 0.02157285
[25] 0.15805439 0.40596553 0.07537122 0.01216056 0.02011675 0.08533531
[31] 0.48874411 0.04668052 0.09936814 0.02371349 0.40555079 0.06617781
[37] 0.01779831 0.37969236</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print non stationary variables (p-values higher than O.1)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a> quarterly_aggregate_seas_adf_test <span class="sc">%&gt;%</span> <span class="fu">filter</span>(adf_test_p_value <span class="sc">&gt;</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(variable) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SWEMPIFSP" "SWEMPFOCP" "SWHP70OCF" "BDGDPIPDE" "FRGDPIPDE" "ITGDPIPDE"</code></pre>
</div>
</div>
<p>A p-value equal or smaller than 0.1 means that we reject the null hypothesis H0 that the time series has a unit root (i.e non stationary). Here, 6 time series are non stationary. Therefore, we apply a differentiation a second time on these variables.</p>
</section>
<section id="normalization-for-pca" class="level3">
<h3 class="anchored" data-anchor-id="normalization-for-pca">Normalization for PCA</h3>
<p>Also, for Principal Components Analysis to work, we need <strong>the data to be normalized</strong> such that each variable has the same scale. The next chunk scales the data with <code>scale</code> (by default with mean 0 and standard deviation of 1)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale quarterly variables </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate_seas <span class="ot">=</span> quarterly_aggregate_seas <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">scale</span>(value)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dealing-with-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-missing-values">Dealing with missing values</h3>
<p>Last but not least, before extracting the factors, we apply <strong>PCA-EM algorithm</strong> to this dataset - not all variables start from the first quarter of 1980, some of them later. In fact, <span class="citation" data-cites="Stock_2002">Stock and Watson (<a href="#ref-Stock_2002" role="doc-biblioref">2002</a>)</span> proposed the EM-algorithm as an imputation method to fill in the missing values. We apply the same algorithm, with a slight difference in the first step by adding a cross-validation procedure as in <span class="citation" data-cites="Josse_2012">Josse et al. (<a href="#ref-Josse_2012" role="doc-biblioref">2012</a>)</span> , also used in <span class="citation" data-cites="burri_2020">Burri and Kaufmann (<a href="#ref-burri_2020" role="doc-biblioref">2020</a>)</span>. The <code>MissMDA</code> library is used. In this next code chunk, we apply this revisited EM-algorithm. We also notice that there is 24.8% of missing values in our quarterly data set (especially between 1980 and 2000).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the data frame in wide format and get rid of "yq" (dates) for the EM-algorithm</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate_seas[,<span class="dv">3</span>]<span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.nan</span>(quarterly_aggregate_seas<span class="sc">$</span>value), <span class="cn">NA</span>,quarterly_aggregate_seas<span class="sc">$</span>value) <span class="co"># Deal with NaN</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate_EM <span class="ot">&lt;-</span> quarterly_aggregate_seas <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(yq,variable,value) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>variable, <span class="at">values_from=</span>value)  <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>yq)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate_EM <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(quarterly_aggregate_EM)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the proportion of missing values</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>missing_count <span class="ot">&lt;-</span> <span class="fu">colSums</span>(<span class="fu">is.na</span>(quarterly_aggregate_EM ))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>total_count <span class="ot">&lt;-</span> <span class="fu">dim</span>(quarterly_aggregate_EM )</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of missing values:"</span>, <span class="fu">sum</span>(missing_count), <span class="st">"/"</span>, total_count[<span class="dv">1</span>]<span class="sc">*</span>total_count[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of missing values: 6411 / 25777 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ----&gt; 24.8% of missing values </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="do">##### EM algorithm ######## ----------</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the number of principal components that will be use to impute the data</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>test_pca <span class="ot">&lt;-</span> <span class="fu">estim_ncpPCA</span>(quarterly_aggregate_EM,<span class="at">ncp.min =</span> <span class="dv">1</span>, <span class="at">ncp.max =</span> <span class="dv">10</span>, <span class="at">method =</span> <span class="st">"EM"</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the imputed data, This is the E-step and M-step</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>imputated_df <span class="ot">&lt;-</span> <span class="fu">imputePCA</span>(quarterly_aggregate_EM, <span class="at">ncp =</span> test_pca<span class="sc">$</span>ncp,<span class="at">method=</span><span class="st">"EM"</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate_final <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(imputated_df<span class="sc">$</span>completeObs)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">#The imputated_df is the object that contains the input data, the estimated data...</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">#The daframe should look like this (wide format)</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># var_1 | var_3 | var_3|</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ------|-------|------|</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.34  |  1.7  | 2 |</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ------|-------|------|</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.23  |  1.5   | 3.5 |</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ------|-------|------|</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.29   |  3   | 5 |</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ------|-------|------|</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.90  |  -3    | -4  |</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co"># We add back the dates quarterly_aggregate_final and visualize the final dataframe </span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>quarterly_aggregate_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">unique</span>(quarterly_aggregate_seas<span class="sc">$</span>yq),quarterly_aggregate_final)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(quarterly_aggregate_final)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"date"</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(quarterly_aggregate_final[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">n=</span><span class="dv">4</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        date     SWCNPERC   SWCNGOVC
1 1980-01-01 -0.032482712 -0.2276055
2 1980-04-01 -0.645870306  1.8585853
3 1980-07-01 -0.009509818  0.9343675
4 1980-10-01  0.109959577  0.5837586</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print the 4 first observations of the first 2 variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, quarterly level data are converted into monthly frequency using a <strong>shape-preserving piecewise cubic interpolation</strong> as in <span class="citation" data-cites="Miranda_2020">Miranda-Agrippino and Rey (<a href="#ref-Miranda_2020" role="doc-biblioref">2020</a>)</span> using <code>spline</code> command from the <code>splines</code> library. This step is optional but in our case is required given that the large number of parameters to estimate. It provides us more observations (i.e data points) for the estimation part.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform cubic interpolation for Quarterly Dataset </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>date_int <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(quarterly_aggregate_final<span class="sc">$</span>date)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>month_int <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"1980-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-04-01"</span>), <span class="at">by =</span> <span class="st">"month"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>interpolated_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">date =</span> month_int) <span class="co"># Create a new data frame to store interpolated values</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform cubic interpolation for Quarterly dataset through a loop</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">names</span>(quarterly_aggregate_final)[<span class="sc">-</span><span class="dv">1</span>]) {</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract values for a specific column</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  quarterly_final_interpolated <span class="ot">&lt;-</span> quarterly_aggregate_final[[i]]</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cubic spline interpolation for each column</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  variables_interpolated <span class="ot">&lt;-</span> <span class="fu">spline</span>(<span class="at">x =</span> date_int, <span class="at">y =</span> quarterly_final_interpolated, <span class="at">xout =</span> month_int, <span class="at">method =</span> <span class="st">"fmm"</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Replace the original column with the interpolated values</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  interpolated_data[[i]] <span class="ot">&lt;-</span> variables_interpolated<span class="sc">$</span>y[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(interpolated_data)]</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolated final dataframe interpolated_data</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking interpolated data for the first variable of the dataframe and for its 15 first observations</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co"># in blue the variable in quarterly frequency and in black the same variable in monthly frequency</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>check <span class="ot">=</span> quarterly_aggregate_final <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>date,<span class="at">names_to =</span> <span class="st">"name"</span>,<span class="at">values_to =</span> <span class="st">"value"</span>, <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(name) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>interpolated_data <span class="sc">%&gt;%</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="fu">gather</span>(<span class="at">key=</span>key,<span class="at">value=</span>value,<span class="sc">-</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(key) <span class="sc">%&gt;%</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>value,<span class="at">color =</span> <span class="st">"interpolated data (monthly)"</span>)) <span class="sc">+</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>check, <span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>value,<span class="at">color =</span> <span class="st">"original data (quarterly)"</span>)) <span class="sc">+</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"interpolated data (monthly)"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"original data (quarterly)"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>key,<span class="at">scales=</span><span class="st">'free'</span>) <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>   <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="cn">NULL</span>)) <span class="co"># Remove the legend title</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="FAVAR_replication_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="frequency" class="level3">
<h3 class="anchored" data-anchor-id="frequency">Frequency</h3>
<p>Note also that many of the series used in this project are not only available at quarterly but only at monthly or daily frequency (mixed frequency series). As said before, we decided to convert all the series to monthly values in order to have <strong>high-frequency</strong> data with more observations. For temporal aggregation related to daily data, we take the <strong>monthly average</strong> (replicated in the next code chunk). Thus, in our specification, monthly variables <span class="math inline">\(x_{i,t}^m\)</span> are defined as the average of daily observations <span class="math inline">\(x_{i,t}^d\)</span> on the number of days <span class="math inline">\(N\)</span> of each month : <span class="math display">\[x_{i,t}^m = \frac{1}{N}\sum_{t=1}^{N} x_{i,t}^d\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#.... After loading daily variables in a separate dataframe :</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>daily_in_monthly <span class="ot">=</span> daily_dataframe <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable, <span class="at">ym =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(yd, <span class="st">'month'</span>)) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">value =</span> <span class="fu">mean</span>(value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The subsequent procedures, such as ensuring stationarity, scaling data and handling missing values, remain consistent with those applied to quarterly variables. However, seasonal adjustment is not always performed since the daily variables in question pertain to financial indices. Naturally, no seasonal pattern in the financial markets is assumed.</p>
<p>Once we have the three different final “clean” data frames in the same frequency we <strong>combine</strong> them in a single data frame and <strong>export the final output</strong> in <code>csv</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export in csv format (can also be exported in Rdata format)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(data_final,<span class="st">"data/data_final.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="favar-estimation" class="level1">
<h1>FAVAR estimation</h1>
<section id="favar-framework" class="level3">
<h3 class="anchored" data-anchor-id="favar-framework">FAVAR framework</h3>
<p>The FAVAR model was created by <span class="citation" data-cites="Bernanke_2005">Bernanke, Boivin, and Eliasz (<a href="#ref-Bernanke_2005" role="doc-biblioref">2005</a>)</span> as an adaptation of a structural dynamic factor model <span class="citation" data-cites="Stock_2002">Stock and Watson (<a href="#ref-Stock_2002" role="doc-biblioref">2002</a>)</span> . The FAVAR depicts the dynamics of a <strong>small number of estimated factors</strong>, which summarize the <strong>common information of a large set of variables</strong>, together with an observed variable (in our case, the Swiss GDP growth rate : our target to forecast), within a <strong>vector autoregressive (VAR) model</strong>.</p>
<ul>
<li><p>The huge underlying informative set of the FAVAR reduces the <strong>omitted variables bias</strong></p></li>
<li><p>The FAVAR overcomes the <strong>overparametrization issue</strong> of the traditional VAR.</p></li>
<li><p>Factors models are increasingly used in central banks for macroeconomic forecasting purposes.</p></li>
</ul>
</section>
<section id="factors-extraction" class="level3">
<h3 class="anchored" data-anchor-id="factors-extraction">Factors extraction</h3>
<p>The econometric framework used in this project relies on FAVAR Models as proposed by <span class="citation" data-cites="Bernanke_2005">Bernanke, Boivin, and Eliasz (<a href="#ref-Bernanke_2005" role="doc-biblioref">2005</a>)</span> extended to include international factors in the spirit of <span class="citation" data-cites="Boivin_2009">Boivin, Giannoni, and Mihov (<a href="#ref-Boivin_2009" role="doc-biblioref">2009</a>)</span>, <span class="citation" data-cites="Mumtaz_2009">Mumtaz and Surico (<a href="#ref-Mumtaz_2009" role="doc-biblioref">2009</a>)</span> and <span class="citation" data-cites="Vasishtha_2013">Vasishtha and Maier (<a href="#ref-Vasishtha_2013" role="doc-biblioref">2013</a>)</span>. Before proceeding with factor extraction as described above, we <strong>first load the data frame</strong> from the previous section and perform some <strong>final adjustments</strong>. These adjustments involve <strong>descaling</strong> the <strong>target variable</strong>, <strong>reducing the estimation sample</strong> to the period from 2000 to 2023 due to multiple structural breaks observed between 1980 and 2000 and removing outliers using a <strong>winsorization procedure</strong>. Specifically, we apply winsorization at 99% across the entire sample and at 95% during the Covid period to address outliers effectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Data and apply some adjustments</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>data_final <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/data_final.csv"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Descale the target variable</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>data_final <span class="ot">&lt;-</span> data_final <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(variable<span class="sc">==</span><span class="st">"SWGDPD"</span>, <span class="fu">scale</span>(value),value)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Start from 2000-01-01 (structural breaks before)</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>data_final <span class="ot">=</span> data_final <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(ym <span class="sc">&gt;=</span> <span class="st">'2000-01-01'</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract before winsorisation (FAVAR model) the observed values of the target variable</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># It will be useful for forecast errors (Realized Values of the target variable)</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>Y_observed <span class="ot">=</span> data_final <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">"SWGDPD"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">everything</span>(),<span class="sc">-</span>Variable,<span class="sc">-</span>TickerDatastream,<span class="sc">-</span>Frequency,<span class="sc">-</span>Start,<span class="sc">-</span>Adj,<span class="sc">-</span>Type,<span class="sc">-</span>Country) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> value)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># First Winsorization at 1% on the entire sample</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>data_final <span class="ot">=</span> data_final <span class="sc">%&gt;%</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(ym <span class="sc">&gt;=</span> <span class="st">'2000-01-01'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">case_when</span>(value <span class="sc">&gt;=</span> <span class="fu">quantile</span>(value,<span class="fl">0.99</span>) <span class="sc">~</span> <span class="fu">quantile</span>(value,<span class="fl">0.99</span>), </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>                           value <span class="sc">&lt;=</span> <span class="fu">quantile</span>(value,<span class="fl">0.01</span>) <span class="sc">~</span> <span class="fu">quantile</span>(value,<span class="fl">0.01</span>), </span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> value))</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Second Winsorization at 5% on the Covid period only</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>data_final <span class="ot">=</span> data_final <span class="sc">%&gt;%</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(ym <span class="sc">&gt;=</span> <span class="st">'2000-01-01'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(ym <span class="sc">&gt;=</span> <span class="st">'2020-01-01'</span>,</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">case_when</span>(value <span class="sc">&gt;=</span> <span class="fu">quantile</span>(value, <span class="fl">0.95</span>) <span class="sc">~</span> <span class="fu">quantile</span>(value, <span class="fl">0.95</span>), </span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>                                  value <span class="sc">&lt;=</span> <span class="fu">quantile</span>(value, <span class="fl">0.05</span>) <span class="sc">~</span> <span class="fu">quantile</span>(value, <span class="fl">0.05</span>), </span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>                                  <span class="cn">TRUE</span> <span class="sc">~</span> value),</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>                        value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The model includes two <strong>blocks of factors</strong>; one for <em>Switzerland</em> (named <strong>domestic block</strong>) and one for the <em>rest of world</em> (named <strong>foreign block</strong>), extracted respectively from large sets of Swiss and international time series. The latter refer to economic variables from the main trading partners of Switzerland and having the weight to impact Swiss economy (UK, Italy, USA, China, France, Germany, Japan).</p>
<p><em>The measurement equation</em> is :</p>
<span class="math display">\[\begin{eqnarray}
\begin{pmatrix}
X_{t}^{H} \\
X_{t}^{*}
\end{pmatrix}
= \begin{pmatrix}
\Lambda_{11}^{H} &amp; \Lambda_{12}^{*} \\
0 &amp; \Lambda_{22}^{*}
\end{pmatrix}
\begin{pmatrix}
F_{t}^{H} \\
F_{t}^{*}
\end{pmatrix}
+ \begin{pmatrix}
\Lambda_{1}^{Y} \\
0
\end{pmatrix}
Y_{t}
+ \begin{pmatrix}
v_{t}^{H} \\
v_{t}^{*}
\end{pmatrix}
\label{Eq_measurement}
\end{eqnarray}\]</span>
<p>where domestic and foreign observational time series: <span class="math inline">\(X_{t}=[X_{t}^{H},X_{t}^{*}]\)</span> and domestic and foreign unobserved factors: <span class="math inline">\(F_{t}=[F_{t}^{H},F_{t}^{*}]\)</span>. <span class="math inline">\(v_t \sim \mathcal{N}(0, \Sigma)\)</span> is a vector of reduced form errors.</p>
<p>As you notice in the measurement equation, we allow the domestic observed variables to load on both domestic and foreign factors as well as target variable <span class="math inline">\(Y_t\)</span>, whereas foreign variables only load on foreign factors like in <span class="citation" data-cites="Kamber_2016">Kamber et al. (<a href="#ref-Kamber_2016" role="doc-biblioref">2016</a>)</span> and following our small open economy framework.</p>
<p>In the next code chunk, we extract the foreign factors using the <code>prcomp</code> command by selecting the first principal component of each type of foreign variable (Real Activity, Inflation, Money and Interest Rates, and Financial Conditions), which explains the majority of the total variance in the associated data set. This process is straightforward because foreign variables only load onto foreign factors. The <code>summary</code> command displays the total variance explained by the first principal component.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Extraction foreign factor (Real activity)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>foreign_RA <span class="ot">&lt;-</span> data_final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Type<span class="sc">==</span><span class="st">"RA"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">!=</span> <span class="st">"Switzerland"</span>) <span class="co"># Filter foreign Real Activity Variables</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>foreign_RA <span class="ot">&lt;-</span> foreign_RA <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">everything</span>(),<span class="sc">-</span>Variable,<span class="sc">-</span>TickerDatastream,<span class="sc">-</span>Frequency,<span class="sc">-</span>Start,<span class="sc">-</span>Adj,<span class="sc">-</span>Type,<span class="sc">-</span>Country) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> value) <span class="co"># Wide format</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>foreign_RA <span class="ot">&lt;-</span> foreign_RA[,<span class="sc">-</span><span class="dv">1</span>] <span class="co"># Get rid of the date column</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>pc_foreign_RA <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(foreign_RA,<span class="at">center =</span> <span class="cn">FALSE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>, <span class="at">rank.=</span><span class="dv">1</span>) <span class="co"># already scaled</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pc_foreign_RA) <span class="co"># Total Variance explained by the first principal component</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of first k=1 (out of 53) components:
                          PC1
Standard deviation     2.5531
Proportion of Variance 0.2716
Cumulative Proportion  0.2716</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Extraction foreign factor (Inflation)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>foreign_INF <span class="ot">&lt;-</span> data_final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Type<span class="sc">==</span><span class="st">"RA"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">!=</span> <span class="st">"Switzerland"</span>) <span class="co"># Filter foreign Inflation Variables</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>foreign_INF <span class="ot">&lt;-</span> foreign_INF <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">everything</span>(),<span class="sc">-</span>Variable,<span class="sc">-</span>TickerDatastream,<span class="sc">-</span>Frequency,<span class="sc">-</span>Start,<span class="sc">-</span>Adj,<span class="sc">-</span>Type,<span class="sc">-</span>Country) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> value) <span class="co">#Wide format</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>foreign_INF <span class="ot">&lt;-</span> foreign_INF[,<span class="sc">-</span><span class="dv">1</span>] <span class="co"># Get rid of the date column</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>pc_foreign_INF <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(foreign_INF,<span class="at">center =</span> <span class="cn">FALSE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>, <span class="at">rank.=</span><span class="dv">1</span>) <span class="co"># already scaled</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pc_foreign_INF) <span class="co"># Total Variance explained by the first principal component</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of first k=1 (out of 53) components:
                          PC1
Standard deviation     2.5531
Proportion of Variance 0.2716
Cumulative Proportion  0.2716</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Extraction foreign factor (Money and Interest Rates)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>foreign_MI <span class="ot">&lt;-</span> data_final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Type<span class="sc">==</span><span class="st">"MI"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">!=</span> <span class="st">"Switzerland"</span>) <span class="co"># Filter foreign Money and Interest Rates Variables</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>foreign_MI <span class="ot">&lt;-</span> foreign_MI <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">everything</span>(),<span class="sc">-</span>Variable,<span class="sc">-</span>TickerDatastream,<span class="sc">-</span>Frequency,<span class="sc">-</span>Start,<span class="sc">-</span>Adj,<span class="sc">-</span>Type,<span class="sc">-</span>Country) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> value) <span class="co">#Wide format</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>foreign_MI <span class="ot">&lt;-</span> foreign_MI[,<span class="sc">-</span><span class="dv">1</span>] <span class="co"># Get rid of the date column</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>pc_foreign_MI <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(foreign_MI,<span class="at">center =</span> <span class="cn">FALSE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>, <span class="at">rank.=</span><span class="dv">1</span>) <span class="co"># already scaled</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pc_foreign_MI) <span class="co"># Total Variance explained by the first principal component</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of first k=1 (out of 46) components:
                          PC1
Standard deviation     2.1147
Proportion of Variance 0.2163
Cumulative Proportion  0.2163</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Extraction foreign factor (Financial conditions)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>foreign_FC <span class="ot">&lt;-</span> data_final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Type<span class="sc">==</span><span class="st">"FC"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">!=</span> <span class="st">"Switzerland"</span>) <span class="co"># Filter foreign Financial conditions Variables</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>foreign_FC <span class="ot">&lt;-</span> foreign_FC <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">everything</span>(),<span class="sc">-</span>Variable,<span class="sc">-</span>TickerDatastream,<span class="sc">-</span>Frequency,<span class="sc">-</span>Start,<span class="sc">-</span>Adj,<span class="sc">-</span>Type,<span class="sc">-</span>Country) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> value) <span class="co">#Wide format</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>foreign_FC <span class="ot">&lt;-</span> foreign_FC[,<span class="sc">-</span><span class="dv">1</span>] <span class="co"># Get rid of the date column</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>pc_foreign_FC <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(foreign_FC,<span class="at">center =</span> <span class="cn">FALSE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>, <span class="at">rank.=</span><span class="dv">1</span>) <span class="co"># already scaled</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pc_foreign_FC) <span class="co"># Total Variance explained by the first principal component</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of first k=1 (out of 41) components:
                          PC1
Standard deviation     3.1674
Proportion of Variance 0.3286
Cumulative Proportion  0.3286</code></pre>
</div>
</div>
<p>Now let’s <strong>extract domestic factors</strong>. It is not as straightforward as with foreign factors because domestic variables load on domestic factors, foreign factors and on the target variable (<span class="math inline">\(Y_t\)</span>), i.e the Swiss GDP growth rate. Therefore, with an iteration procedure like in <span class="citation" data-cites="Boivin_2009">Boivin, Giannoni, and Mihov (<a href="#ref-Boivin_2009" role="doc-biblioref">2009</a>)</span>, we remove what we explain by foreign factor and <span class="math inline">\(Y_t\)</span> . By simplicity, we do not extract the first principal component of the domestic variables for each type (Real Activity, Inflation, Money and Interest rates and Financial Conditions) but the first 4 principal components on all Swiss variables in the spirit <span class="citation" data-cites="Boivin_2009">Boivin, Giannoni, and Mihov (<a href="#ref-Boivin_2009" role="doc-biblioref">2009</a>)</span>. We also perform the test proposed by Bai and Ng (2002) in order to determine the optimal number of factors <span class="math inline">\(r^*\)</span>. According to the second criteria <span class="math inline">\(IC_2\)</span>, the optimal number is 8 but 3 factors should be fineto capture most of the information if we rely on the screeplot below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter all Swiss variables</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>Xdom <span class="ot">&lt;-</span> data_final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span> <span class="st">'Switzerland'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Variable,<span class="sc">-</span>TickerDatastream,<span class="sc">-</span>Frequency,<span class="sc">-</span>Start,<span class="sc">-</span>Adj,<span class="sc">-</span>Type,<span class="sc">-</span>Country) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>ym)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># filter the target variable</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>SWGDP <span class="ot">&lt;-</span> data_final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(variable<span class="sc">==</span> <span class="st">'SWGDPD'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Variable,<span class="sc">-</span>TickerDatastream,<span class="sc">-</span>Frequency,<span class="sc">-</span>Start,<span class="sc">-</span>Adj,<span class="sc">-</span>Type,<span class="sc">-</span>Country) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>ym)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>bai_and_ng_optimal_factors <span class="ot">&lt;-</span> <span class="fu">ICr</span>(Xdom) <span class="co"># Determine the optimal number of factors with Bai and Ng criterie</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(bai_and_ng_optimal_factors ) <span class="co"># Visualization inspection (screeplot)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="FAVAR_replication_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Remove by iteration (like in Boivin) the foreign and $Y_t$ part from the domestic variables space (50 iterations like in Burri (2020))</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Xresid matrix (residuals matrix)</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>Xresid <span class="ot">&lt;-</span> Xdom</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a> rep <span class="ot">=</span> <span class="dv">50</span> <span class="co"># number of iterations</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a> fc_dom <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(Xdom, <span class="at">rank=</span><span class="dv">3</span>) <span class="co"># Estimate the 3 first principal components on Swiss variables </span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a> <span class="co"># Start the iteration</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span>(n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>rep){</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(Xdom)[<span class="dv">2</span>]){</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Estimate residuals in domestic variables</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Xdom[,i], pc_foreign_RA<span class="sc">$</span>x,pc_foreign_INF<span class="sc">$</span>x,pc_foreign_MI<span class="sc">$</span>x,pc_foreign_FC<span class="sc">$</span>x,SWGDP,fc_dom<span class="sc">$</span>x[,<span class="dv">1</span>],fc_dom<span class="sc">$</span>x[,<span class="dv">2</span>],fc_dom<span class="sc">$</span>x[,<span class="dv">3</span>])</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"fc_for_RA"</span>,<span class="st">"fc_for_INF"</span>,<span class="st">"fc_for_MI"</span>,<span class="st">"fc_for_FC"</span>, <span class="st">"GDP"</span>,<span class="st">"fc_dom_1"</span>,<span class="st">"fc_dom_2"</span>,<span class="st">"fc_dom_3"</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>Reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(x<span class="sc">~</span>fc_for_RA <span class="sc">+</span>fc_for_INF <span class="sc">+</span> fc_for_MI <span class="sc">+</span> fc_for_FC <span class="sc">+</span>  GDP <span class="sc">+</span> fc_dom_1 <span class="sc">+</span> fc_dom_2 <span class="sc">+</span> fc_dom_3 , <span class="at">data =</span> Data)</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>        Xresid[,i] <span class="ot">&lt;-</span> Data<span class="sc">$</span>x <span class="sc">-</span> Reg<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="sc">-</span> Reg<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>Data<span class="sc">$</span>fc_for_RA <span class="sc">-</span> Reg<span class="sc">$</span>coefficients[<span class="dv">4</span>]<span class="sc">*</span>Data<span class="sc">$</span>fc_for_MI <span class="sc">-</span>  Reg<span class="sc">$</span>coefficients[<span class="dv">5</span>]<span class="sc">*</span>Data<span class="sc">$</span>fc_for_FC <span class="sc">-</span> Reg<span class="sc">$</span>coefficients[<span class="dv">6</span>]<span class="sc">*</span>Data<span class="sc">$</span>GDP</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove foreign inflation factor because of multicolinearity found</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>     PCdom   <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(Xresid,<span class="at">rank=</span> <span class="dv">3</span>)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>     fc_dom<span class="sc">$</span>x[,<span class="dv">1</span>] <span class="ot">&lt;-</span> PCdom<span class="sc">$</span>x[,<span class="dv">1</span>]</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>     fc_dom<span class="sc">$</span>x[,<span class="dv">2</span>] <span class="ot">&lt;-</span> PCdom<span class="sc">$</span>x[,<span class="dv">2</span>]</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>     fc_dom<span class="sc">$</span>x[,<span class="dv">3</span>] <span class="ot">&lt;-</span> PCdom<span class="sc">$</span>x[,<span class="dv">3</span>]</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a> fc_dom <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(fc_dom<span class="sc">$</span>x[,<span class="dv">1</span>],fc_dom<span class="sc">$</span>x[,<span class="dv">2</span>],fc_dom<span class="sc">$</span>x[,<span class="dv">3</span>])</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a> <span class="fu">colnames</span>(fc_dom) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"fc_dom_1"</span>,<span class="st">"fc_dom_2"</span>,<span class="st">"fc_dom_3"</span>) <span class="co"># Domestic factors </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can plot our 3 domestic factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a sequence of dates</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2000-01-01"</span>), <span class="at">by =</span> <span class="st">"1 month"</span>, <span class="at">length.out =</span> <span class="fu">nrow</span>(fc_dom))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the xts object with the principal components and the dates</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>ts_dom_fc <span class="ot">&lt;-</span> <span class="fu">xts</span>(fc_dom, <span class="at">order.by =</span> dates)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the plotting layout to display three plots in two rows</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot each factor separately</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a new plot for each factor</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ts.plot</span>(ts_dom_fc[, i], <span class="at">gpars =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"blue"</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Domestic Factor"</span>, i), <span class="at">xlab =</span> <span class="st">"Date"</span>, <span class="at">ylab =</span> <span class="st">"Value"</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add legend for each plot</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"Factor"</span>, i), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="FAVAR_replication_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="var-modeling" class="level2">
<h2 class="anchored" data-anchor-id="var-modeling">VAR Modeling</h2>
<p>Then, for the second step of the estimation, we can model our <strong>factors</strong> estimated by <strong>Principal Components</strong> along with the target variable to forecast within a <strong>VAR framework</strong> with Ordinary Least Squares (OLS). This can be estimated equation by equation with the <code>vars</code> library. The <em>VAR transition equation</em> is the following :</p>
<span class="math display">\[\begin{equation}
\begin{pmatrix}
Y_t \\
F_t^H \\
F_t^*
\end{pmatrix}
=
\begin{pmatrix}
\phi_{11}(L) &amp; \phi_{12}(L) &amp; \phi_{13}(L) \\
\phi_{21}(L) &amp; \phi_{22}(L) &amp; \phi_{23}(L) \\
0 &amp; 0 &amp; \phi_{33}(L)
\end{pmatrix}
\begin{pmatrix}
Y_{t-1} \\
F_{t-1}^H \\
F_{t-1}^*
\end{pmatrix}
+
\begin{pmatrix}
u_t^Y \\
u_t^H \\
u_t^*
\end{pmatrix}
\end{equation}\]</span>
<p>with <span class="math inline">\(u_t \sim \mathcal{N} (0, \Omega)\)</span> a vector of reduced form errors.</p>
<p>As you can see, we exploit the fact that Switzerland is a small open economy in the transition equation (restricted VAR model) where foreign factors have an impact on domestic factors and the Swiss target variable but are not governed by them. However, we do not put restrictions on our VAR matrix because the domestic factors are orthogonal to the foreign factors by construction (<em>first step of the estimation</em>). Thus, foreign factors are not affected by domestic factors.</p>
<p>In scalar form, the variable we wish to forecast follows the following dynamics:<span class="math display">\[y_{i,t+h} = C_{1} + \phi_{11}(L)y_{i,t} + \phi_{12}(L)F^H_{t} + \phi_{13}(L) F_t^F + e_{1t}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>VAR_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(SWGDP,fc_dom,pc_foreign_RA<span class="sc">$</span>x,pc_foreign_MI<span class="sc">$</span>x,pc_foreign_FC<span class="sc">$</span>x) <span class="co"># load the extracted factors in step 1 along with the target variable SWGDP, note that fc_dom contains already our 3 domestic factors.</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the columns</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(VAR_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SWGDPD"</span>, <span class="st">"fc_dom_1"</span>, <span class="st">"fc_dom_2"</span>,<span class="st">"fc_dom_3"</span>,<span class="st">"fc_for_RA"</span>,<span class="st">"fc_for_MI"</span>,<span class="st">"fc_for_FC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we have a data frame with the target and the domestic and foreign factors, we need to select the optimal number of lags. There are different criteria from which we can choose. We choose the most parsimonious one the <span class="math inline">\(SC_n\)</span> criteria (the third one in <code>VARselect</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>vars<span class="sc">::</span><span class="fu">VARselect</span>(VAR_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$selection
AIC(n)  HQ(n)  SC(n) FPE(n) 
     9      4      2      6 

$criteria
                1           2            3            4            5
AIC(n) -1.1551333 -4.20643370 -4.728889582 -5.387756672 -5.510733408
HQ(n)  -0.8554359 -3.64450110 -3.904721776 -4.301353655 -4.162095180
SC(n)  -0.4087940 -2.80704738 -2.676456316 -2.682276459 -2.152206246
FPE(n)  0.3150538  0.01491136  0.008858703  0.004598919  0.004088602
                  6            7            8            9           10
AIC(n) -5.650838744 -5.619230426 -5.660116437 -5.663729622 -5.526804178
HQ(n)  -4.039965305 -3.746121776 -3.524772576 -3.266150550 -2.866989896
SC(n)  -1.639264634 -0.954609368 -0.342448431  0.306985332  1.096957724
FPE(n)  0.003582494  0.003738881  0.003642824  0.003700104  0.004347118</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>opt.lags <span class="ot">=</span> vars<span class="sc">::</span><span class="fu">VARselect</span>(VAR_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s say we choose the <span class="math inline">\(SC_n\)</span> criterion that suggests that the optimal lag is equal to 2.</p>
<p>We can now estimate the model using the function <code>VAR</code> from the package <code>vars</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>FAVAR <span class="ot">=</span> vars<span class="sc">::</span><span class="fu">VAR</span>(VAR_data, <span class="at">p=</span> opt.lags<span class="sc">$</span>selection[<span class="dv">3</span>], <span class="at">type =</span> <span class="st">"const"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(FAVAR)<span class="sc">$</span>varresult[[<span class="dv">1</span>]] <span class="co"># First equation of the FAVAR</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ -1 + ., data = datamat)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.98029 -0.08064  0.00529  0.07972  1.83765 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
SWGDPD.l1     1.605292   0.062618  25.636   &lt;2e-16 ***
fc_dom_1.l1   0.002676   0.009969   0.268   0.7886    
fc_dom_2.l1   0.015280   0.013500   1.132   0.2587    
fc_dom_3.l1   0.014359   0.012031   1.193   0.2338    
fc_for_RA.l1  0.040296   0.019765   2.039   0.0425 *  
fc_for_MI.l1  0.001309   0.014152   0.093   0.9264    
fc_for_FC.l1 -0.002505   0.006769  -0.370   0.7117    
SWGDPD.l2    -0.822950   0.062079 -13.257   &lt;2e-16 ***
fc_dom_1.l2  -0.002673   0.010192  -0.262   0.7933    
fc_dom_2.l2  -0.014770   0.013032  -1.133   0.2581    
fc_dom_3.l2  -0.010139   0.011856  -0.855   0.3932    
fc_for_RA.l2 -0.057014   0.019286  -2.956   0.0034 ** 
fc_for_MI.l2  0.010646   0.014143   0.753   0.4523    
fc_for_FC.l2 -0.005369   0.006491  -0.827   0.4090    
const         0.019654   0.013390   1.468   0.1433    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2005 on 263 degrees of freedom
Multiple R-squared:  0.9152,    Adjusted R-squared:  0.9107 
F-statistic: 202.8 on 14 and 263 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="diagnostic-checks" class="level2">
<h2 class="anchored" data-anchor-id="diagnostic-checks">Diagnostic checks</h2>
<p><strong>We also carry out a battery of diagnostic checks</strong></p>
<ul>
<li>Invertibility and Stationarity of the FAVAR</li>
</ul>
<p>All the roots lie inside the unit circle. Therefore, the FAVAR is stationary and invertible. Covariance stationarity is an important property for representation, estimation and inference.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">roots</span>(FAVAR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.9280405 0.9280405 0.8413460 0.8413460 0.8325475 0.8325475 0.8232638
 [8] 0.7363609 0.7363609 0.6965668 0.6905134 0.6905134 0.3731820 0.1345483</code></pre>
</div>
</div>
<ul>
<li><p>Structural Breaks</p>
<p>We also perform an OLS-CUSUM test (structural break test) suggesting that there is parameter instability if the cumulative sum of the recursive residuals breaks one of the two boundaries in red in the graph below. The test is performed for each equation of our FAVAR model. There was parameter instability in the old sample (1980-2023). That’s why we reduced the estimation sample (from 2000 to 2023 now).</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>)) </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>stability_test <span class="ot">&lt;-</span> <span class="fu">stability</span>(FAVAR,<span class="at">type =</span> <span class="fu">c</span>(<span class="st">"OLS-CUSUM"</span>))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stability_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="FAVAR_replication_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Test of residuals</li>
</ul>
<p>We also do some tests on residuals</p>
<p>-Arch Test detects volatility clustering by examining the autocorrelation of squared residuals in a time series model.</p>
<p>-Normality test assesses if residuals follow a normal distribution</p>
<p>-Serial test checks for correlation between residuals at different lags in a time series model.</p>
<p><strong>Result :</strong> We reject at 1% the null hypothesis of all these tests meaning firstly that there is significant evidence of conditional heteroskedasticity in the data. In other words, it suggests that the variance of the errors is not constant over time and there are patterns or clusters of volatility in the data (ARCH effects) but also that the residuals are not normally distributed and auto correlated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Arch Test</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arch.test</span>(FAVAR,<span class="at">multivariate.only =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    ARCH (multivariate)

data:  Residuals of VAR object FAVAR
Chi-squared = 4795.1, df = 3920, p-value &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normality test</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">normality.test</span>(FAVAR, <span class="at">multivariate.only =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$JB

    JB-Test (multivariate)

data:  Residuals of VAR object FAVAR
Chi-squared = 11594, df = 14, p-value &lt; 2.2e-16


$Skewness

    Skewness only (multivariate)

data:  Residuals of VAR object FAVAR
Chi-squared = 184.37, df = 7, p-value &lt; 2.2e-16


$Kurtosis

    Kurtosis only (multivariate)

data:  Residuals of VAR object FAVAR
Chi-squared = 11410, df = 7, p-value &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Serial correlation test</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">serial.test</span>(FAVAR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Portmanteau Test (asymptotic)

data:  Residuals of VAR object FAVAR
Chi-squared = 1178.1, df = 686, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="fanchart" class="level2">
<h2 class="anchored" data-anchor-id="fanchart">Fanchart</h2>
<p>The package <code>vars</code> provides a variety of tools to analyse and represent the results graphically. For example, the <code>fanchart</code> command provides a graphical representation of the forecasts and their confidence intervals. We illustrate it with a short forecast 4 quarters ahead (12 steps ahead as data are in monthly frequency).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>FAVAR_prediction <span class="ot">=</span> <span class="fu">predict</span>(FAVAR,<span class="at">n.ahead=</span><span class="dv">12</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>vars<span class="sc">::</span><span class="fu">fanchart</span>(FAVAR_prediction, <span class="at">names =</span> <span class="st">"SWGDPD"</span>) <span class="co"># Swiss GDP is winsorized during the Covid period</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="FAVAR_replication_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="pseudo-out-of-sample-evaluation" class="level1">
<h1>Pseudo Out-of-sample evaluation</h1>
<p>Our unconditional forecasts (i.e the optimal <span class="math inline">\(h\)</span>-step ahead forecasts) can be rewritten as :</p>
<p><span class="math display">\[\begin{eqnarray}
\mathbb{E}
\begin{pmatrix}
Y_{t+h} \\
F_{t+h}
\end{pmatrix}
= \sum_{j=1}^{2} \Phi_j
%%%
\begin{pmatrix}
Y^*_{{t-j+h}\vert t}  \\
F^*_{{t-j+h} \vert t}
\end{pmatrix}
\label{fcst_uncond}
\end{eqnarray}\]</span></p>
<p>where <span class="math inline">\(Y^*_{t-j+h\vert t}=Y_{t-j+h}\)</span> and <span class="math inline">\(F^*_{t-j+h\vert t}=F_{t-j+h}\)</span> for <span class="math inline">\(h \leq j\)</span></p>
<p>Using equation this equation, we can forecast the Swiss GDP growth rate in Switzerland for any horizon from 1 (one quarter ahead) to 12 (twelve quarters ahead).</p>
<p>Then, in order to assess the performance of our model, we conduct a pseudo out-of-sample forecast evaluation exercise where the models’ accuracy in predicting Swiss GDP growth is assessed recursively. Indeed, in order to assess the predictive accuracy of our FAVAR model regarding Swiss GDP growth, out-of-sample forecasts are produced each quarter for the period between 2010Q1 and 2023Q2 (evaluation sample). As in <span class="citation" data-cites="Diebold_1995">Diebold and Mariano (<a href="#ref-Diebold_1995" role="doc-biblioref">1995</a>)</span> , we denote <span class="math inline">\(T\)</span> as the length of the whole sample with <span class="math inline">\(t\)</span> ranging from 1 to <span class="math inline">\(T\)</span> (from <span class="math inline">\(2000Q1\)</span> to <span class="math inline">\(2023Q2\)</span>), <span class="math inline">\(R\)</span> (<span class="math inline">\(2010Q1\)</span>) denotes the start of our evaluation sample (where <span class="math inline">\(R &lt; T\)</span>) and <span class="math inline">\(h\)</span> the horizon in quarter (from <span class="math inline">\(h=1\)</span> to <span class="math inline">\(h=12\)</span>). The first step consists in estimating our sample (from <span class="math inline">\(1\)</span> to <span class="math inline">\(R\)</span>). At time <span class="math inline">\(R\)</span>, forecast is calculated for horizon 1 to 12, using equation of the unconditional forecast show above. Then, at time <span class="math inline">\(R+1\)</span>, new information allows the model to be updated and re-estimated and forecasts for horizons one to 12 are calculated using the revised model. Using new data available at <span class="math inline">\(R + t\)</span>, the model is updated and reestimated till the end of the sample minus the horizon. In practice, as we use monthly frequency data, we produce forecasts for Swiss GDP growth rate at the three, six, nine and twelve months horizon (<span class="math inline">\(t+h\)</span>), then we continue by updating the estimation sample by adding one quarter (i.e three months). With this recursive technique, the sample size grows over time. It is considered as the best technique in absence of structural breaks in the sample. Additionally, the size of the training data sample (or estimation sample) from 2000Q1 and 2010Q1 is sufficient to produce stable estimation results. Note that factors are estimated over the full sample and not reestimated at each period primarily due to computational considerations.</p>
<section id="mean-squared-forecast-errors" class="level2">
<h2 class="anchored" data-anchor-id="mean-squared-forecast-errors">Mean squared forecast errors</h2>
<p>Using all the past notation, squared forecast errors can be computed from <span class="math inline">\(R+1\)</span> for each horizon in order to evaluate the accuracy of the model, namely:</p>
<p><span class="math display">\[e_{t,h}^2 = (y_{t+h} - \widehat{y}_{t+h \vert t})^2 \]</span>where <span class="math inline">\(y_{t+h}\)</span> is the realized value of target variable and <span class="math inline">\(\widehat{y}_{t+h \vert t}\)</span> the forecast of the target variable made in time <span class="math inline">\(t\)</span> for horizon <span class="math inline">\(h\)</span>.</p>
<p>Then, Mean Squared Forecast Errors (MSFE) are computed as follow :</p>
<p><span class="math display">\[\begin{eqnarray}
MSFE_h = \frac{1}{P} \sum_{t=R}^{T-h} e_{t,h}^2
\end{eqnarray}\]</span></p>
<p>where <span class="math inline">\(P=T-h-R+1\)</span>.</p>
<p>Therefore, in order to compute the performance of our model relatively to the six benchmarks, we compute the ratio of the relative MSFE, which is defined as :<br>
<span class="math display">\[\begin{eqnarray}\frac{MSFE_h}{MSFE_{benchmark,h}}\end{eqnarray}\]</span></p>
<p>When the MSFE ratio is smaller than one, it indicates that our model outperforms the benchmark. Conversely, when the ratio is larger than one, the benchmark performs better than our model</p>
<p>Now, let’s produce a table computing the relative ratio of mean squared forecast errors over several horizons thanks to our homemade function implemented below. Thus function will allow us to compute the relative MSFE over 12 steps ahead (12 quarters ahead) relative to the traditional univariate ARMA(p,q,d) benchmarks. Note that our evaluation sample here starts at 2010M1 (<code>first date = 121</code> ).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#function relative MSFE table over 12 horizons</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>Y_observed <span class="ot">&lt;-</span> <span class="fu">as.ts</span>(Y_observed[,<span class="dv">2</span>])             <span class="co"># Our true values realized values of Swiss GDP growth rate from the beginning (without covid adjustment) -&gt; convert to time series (ts object)</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>relative_msfe_favar <span class="ot">&lt;-</span> <span class="cf">function</span>(observed.target, var.dataframe, <span class="at">h =</span> <span class="dv">36</span>, <span class="at">T =</span> <span class="fu">nrow</span>(var.dataframe), <span class="at">first_date =</span> <span class="dv">121</span>, <span class="at">p_arima =</span> <span class="dv">1</span>, <span class="at">d_arima =</span> <span class="dv">0</span>, <span class="at">q_arima =</span> <span class="dv">0</span>, <span class="at">p_favar =</span> <span class="dv">2</span>) {</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># first date is 2010M1, the start of our evaluation sample  </span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  ratio.table <span class="ot">&lt;-</span> <span class="fu">numeric</span>(h<span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  e1 <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Initialization of the matrix of forecast errors of ARIMA</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  e2 <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Initialization of the matrix of forecast errors of FAVAR</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (h_value <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">3</span>, h, <span class="at">by =</span> <span class="dv">3</span>)) { <span class="co"># Iterate over the h horizons provided</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">from =</span> first_date, <span class="at">to =</span> (T <span class="sc">-</span> h_value), <span class="at">by =</span> <span class="dv">3</span>)) {  <span class="co"># Start of the sequence of forecast errors for each horizon</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Estimation of the ARIMA (recursive scheme)</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>      estim.model.arima <span class="ot">&lt;-</span> <span class="fu">arima</span>(var.dataframe<span class="sc">$</span>SWGDPD[<span class="dv">1</span><span class="sc">:</span>i], <span class="at">order =</span> <span class="fu">c</span>(p_arima, d_arima, q_arima))</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Estimation of the FAVAR (recursive scheme)</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>      estim.model.favar <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var.dataframe[<span class="dv">1</span><span class="sc">:</span>i, ], <span class="at">p =</span> p_favar)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Sequence of forecast errors for horizon h for the ARIMA</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>      e1 <span class="ot">&lt;-</span> <span class="fu">c</span>(e1, (observed.target[i <span class="sc">+</span> h_value] <span class="sc">-</span> <span class="fu">predict</span>(estim.model.arima, <span class="at">n.ahead =</span> h_value)<span class="sc">$</span>pred[h_value])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Sequence of forecast errors for horizon h for the FAVAR</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>      e2 <span class="ot">&lt;-</span> <span class="fu">c</span>(e2, (observed.target[i <span class="sc">+</span> h_value] <span class="sc">-</span> <span class="fu">predict</span>(estim.model.favar, <span class="at">n.ahead =</span> h_value)<span class="sc">$</span>fcst<span class="sc">$</span>SWGDPD[h_value, <span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ratio of relative MSFE per horizon</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>    ratio_per_h <span class="ot">&lt;-</span> <span class="fu">mean</span>(e2) <span class="sc">/</span> <span class="fu">mean</span>(e1)</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>    ratio.table[h_value<span class="sc">/</span><span class="dv">3</span>] <span class="ot">&lt;-</span> ratio_per_h <span class="co"># Construction of the table</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>  result_relative_msfe_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">'Horizon'</span> <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">12</span>), <span class="st">'Ratio'</span> <span class="ot">=</span> ratio.table)</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(kableExtra<span class="sc">::</span><span class="fu">kbl</span>(result_relative_msfe_table, <span class="at">align=</span> <span class="st">"c"</span>, <span class="at">caption =</span> <span class="st">"Ratio of MSFE"</span>, <span class="at">format =</span> <span class="st">"html"</span>,<span class="at">booktabs=</span> <span class="cn">TRUE</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="st">"hover"</span>,<span class="at">full_width =</span> T))</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a><span class="co"># MSFE ratio table with a simple AR(1) process</span></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">relative_msfe_favar</span>(<span class="at">observed.target =</span> Y_observed,</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>                          <span class="at">var.dataframe =</span> VAR_data, </span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>                          <span class="at">h =</span> <span class="dv">36</span>, </span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T =</span> <span class="fu">nrow</span>(VAR_data), </span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>                          <span class="at">first_date =</span> <span class="dv">121</span>, </span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>                          <span class="at">p_arima =</span> <span class="dv">1</span>, </span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>                          <span class="at">d_arima =</span> <span class="dv">0</span>, </span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>                          <span class="at">q_arima =</span> <span class="dv">0</span>, </span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>                          <span class="at">p_favar =</span> <span class="dv">2</span>) </span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-sm table-striped small" data-quarto-postprocess="true">
<caption>Ratio of MSFE</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Horizon</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.88</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.90</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.94</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.94</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">0.95</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">0.96</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;">0.97</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: center;">0.97</td>
</tr>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">0.97</td>
</tr>
<tr class="even">
<td style="text-align: center;">10</td>
<td style="text-align: center;">0.98</td>
</tr>
<tr class="odd">
<td style="text-align: center;">11</td>
<td style="text-align: center;">0.98</td>
</tr>
<tr class="even">
<td style="text-align: center;">12</td>
<td style="text-align: center;">0.98</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>When comparing our FAVAR model with a simple AR(1) process, represented by an ARMA(1,0,0) model, we observe that our FAVAR model outperforms this benchmark across all forecasting horizons (from 1 to 12 quarters). This superiority is indicated by the fact that the ratio of mean squared forecast error (MSFE) between the FAVAR model and the AR(1) process is consistently smaller than 1 over all horizons.</p>
<p>Additionally, to validate the robustness of our FAVAR model, we can conduct further comparisons with alternative ARMA(p,q,d) processes and other multivariate benchmark models such as VAR models with selected leading macro indicators, FAVAR models without foreign blocks or Bayesian VAR (BVAR) models on different evaluation samples (Covid excluded, only before Covid…). These comparisons will provide deeper insights into the relative forecasting performance of our FAVAR model against various alternative modeling approaches.</p>
<p>We can also compute other indicators of performance such as :</p>
<ul>
<li><p>RMSE: Root Mean Squared Error</p></li>
<li><p>MAE: Mean Absolute Error</p></li>
<li><p>MPE: Mean Percentage Error</p></li>
<li><p>MAPE: Mean Absolute Percentage Error</p></li>
<li><p>MASE: Mean Absolute Scaled Error</p></li>
</ul>
<p>It can be can very easily with the package <code>forecast</code> command <code>accuracy</code> .</p>
<p>It can be also interesting to perform some Diebold Mariano test (dm-test) on different horizons so as to assess whether the two models have <strong>significantly</strong> different accuracy [with the help of the <code>dm-test</code> command from the <code>forecast</code> library].</p>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Bernanke_2005" class="csl-entry" role="listitem">
Bernanke, Ben S, Jean Boivin, and Piotr Eliasz. 2005. <span>“Measuring the Effects of Monetary Policy: A Factor-Augmented Vector Autoregressive (FAVAR) Approach.”</span> <em>The Quarterly Journal of Economics</em> 120 (1): 387–422.
</div>
<div id="ref-Boivin_2009" class="csl-entry" role="listitem">
Boivin, Jean, Marc P Giannoni, and Ilian Mihov. 2009. <span>“Sticky Prices and Monetary Policy: Evidence from Disaggregated US Data.”</span> <em>American Economic Review</em> 99 (1): 350–84.
</div>
<div id="ref-burri_2020" class="csl-entry" role="listitem">
Burri, Marc, and Daniel Kaufmann. 2020. <span>“A Daily Fever Curve for the Swiss Economy.”</span> <em>Swiss Journal of Economics and Statistics</em> 156: 1–11.
</div>
<div id="ref-Diebold_1995" class="csl-entry" role="listitem">
Diebold, Francis X, and Roberto S Mariano. 1995. <span>“Com Paring Predictive Accu Racy.”</span> <em>Journal of Business and Economic Statistics</em> 13 (3): 253–63.
</div>
<div id="ref-Josse_2012" class="csl-entry" role="listitem">
Josse, Julie, Marie Chavent, Benot Liquet, and François Husson. 2012. <span>“Handling Missing Values with Regularized Iterative Multiple Correspondence Analysis.”</span> <em>Journal of Classification</em> 29: 91–116.
</div>
<div id="ref-Kamber_2016" class="csl-entry" role="listitem">
Kamber, Güneş, Özer Karagedikli, Michael Ryan, et al. 2016. <span>“International Spill-Overs of Uncertainty Shocks: Evidence from a FAVAR.”</span>
</div>
<div id="ref-Miranda_2020" class="csl-entry" role="listitem">
Miranda-Agrippino, Silvia, and Hélene Rey. 2020. <span>“US Monetary Policy and the Global Financial Cycle.”</span> <em>The Review of Economic Studies</em> 87 (6): 2754–76.
</div>
<div id="ref-Mumtaz_2009" class="csl-entry" role="listitem">
Mumtaz, Haroon, and Paolo Surico. 2009. <span>“The Transmission of International Shocks: A Factor-Augmented VAR Approach.”</span> <em>Journal of Money, Credit and Banking</em> 41: 71–100.
</div>
<div id="ref-Stock_2002" class="csl-entry" role="listitem">
Stock, James H, and Mark W Watson. 2002. <span>“Forecasting Using Principal Components from a Large Number of Predictors.”</span> <em>Journal of the American Statistical Association</em> 97 (460): 1167–79.
</div>
<div id="ref-Vasishtha_2013" class="csl-entry" role="listitem">
Vasishtha, Garima, and Philipp Maier. 2013. <span>“The Impact of the Global Business Cycle on Small Open Economies: A FAVAR Approach for Canada.”</span> <em>The North American Journal of Economics and Finance</em> 24: 191–207.
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>